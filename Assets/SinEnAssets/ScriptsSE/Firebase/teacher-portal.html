<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numeris Teacher Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap');
        
        body { 
            background: linear-gradient(135deg, #1a0f0a 0%, #2d1810 50%, #1a0f0a 100%);
            color: #ffffff;
            font-family: 'Crimson Text', serif;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 69, 19, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container-wrapper {
            position: relative;
            z-index: 1;
        }
        
        h1, h2, h3 { 
            font-family: 'Cinzel', serif; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .card { 
            background: linear-gradient(145deg, #3d2817 0%, #2a1810 100%);
            border: 2px solid #8b6914;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 
                0 8px 16px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(212, 175, 55, 0.2);
            position: relative;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #d4af37, #8b6914, #d4af37);
            border-radius: 8px;
            z-index: -1;
            opacity: 0.3;
        }
        
        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #8b6914, transparent);
            margin: 20px 0;
        }
        
        .medieval-input, .medieval-select, .medieval-textarea {
            background: linear-gradient(to bottom, #2a1810, #1a0f0a);
            border: 2px solid #8b6914;
            color: #d4af37;
            padding: 12px 16px;
            border-radius: 4px;
            font-family: 'Crimson Text', serif;
            width: 100%;
            transition: all 0.3s;
        }
        
        .medieval-input:focus, .medieval-select:focus, .medieval-textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }
        
        .medieval-input::placeholder, .medieval-textarea::placeholder {
            color: #8b6914;
        }
        
        .medieval-button {
            background: linear-gradient(to bottom, #8b6914, #6d5410);
            border: 2px solid #d4af37;
            color: #fff;
            padding: 12px 24px;
            border-radius: 4px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            font-weight: 600;
        }
        
        .medieval-button:hover {
            background: linear-gradient(to bottom, #a07c18, #8b6914);
            box-shadow: 0 6px 12px rgba(0,0,0,0.6);
            transform: translateY(-2px);
        }
        
        .medieval-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .medieval-button-secondary {
            background: linear-gradient(to bottom, #5a3d1f, #3d2817);
            border: 2px solid #8b6914;
        }
        
        .medieval-button-danger {
            background: linear-gradient(to bottom, #8b1414, #6d1010);
            border: 2px solid #d43737;
        }
        
        .tab-button {
            background: transparent;
            border: none;
            color: #8b6914;
            padding: 12px 24px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-weight: 600;
        }
        
        .tab-button.active {
            color: #d4af37;
            border-bottom-color: #d4af37;
        }
        
        .tab-button:hover {
            color: #c4945f;
        }
        
        .question-item {
            background: rgba(45, 24, 16, 0.4);
            border: 1px solid rgba(139, 105, 20, 0.3);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        
        .question-item:hover {
            background: rgba(139, 105, 20, 0.2);
            border-color: #8b6914;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid;
        }
        
        .badge-level1 {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border-color: #4ade80;
        }
        
        .badge-level2 {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border-color: #60a5fa;
        }
        
        .badge-level3 {
            background: rgba(168, 85, 247, 0.15);
            color: #c084fc;
            border-color: #c084fc;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(to bottom, #8b6914, #6d5410);
            border: 2px solid #d4af37;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.6);
            font-family: 'Cinzel', serif;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stat-number {
            font-family: 'Cinzel', serif;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
    </style>
</head>
<body class="p-8">
    <div class="container-wrapper max-w-7xl mx-auto">
        <header class="mb-12 flex justify-between items-center">
            <div>
                <h1 class="text-5xl font-bold mb-2">
                    <span class="text-yellow-600">üìö</span> 
                    <span style="color: #d4af37;">Numeris</span> 
                    <span style="color: #c4945f;">Teacher Portal</span>
                </h1>
                <p class="text-amber-700 text-sm italic">Create & Manage Quest Challenges</p>
            </div>
            <div id="connectionStatus" class="medieval-button">
                üü¢ Connected
            </div>
        </header>

        <div class="divider"></div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
            <div class="card relative">
                <h3 class="text-amber-700 text-sm uppercase tracking-wider mb-3">üìú Total Questions</h3>
                <p id="totalQuestions" class="stat-number text-6xl font-extrabold" style="color: #d4af37;">0</p>
            </div>
            <div class="card relative">
                <h3 class="text-amber-700 text-sm uppercase tracking-wider mb-3">‚öîÔ∏è Level 1 (Arithmetic)</h3>
                <p id="level1Count" class="stat-number text-6xl font-extrabold" style="color: #4ade80;">0</p>
            </div>
            <div class="card relative">
                <h3 class="text-amber-700 text-sm uppercase tracking-wider mb-3">üè∞ Level 2 (Geometry)</h3>
                <p id="level2Count" class="stat-number text-6xl font-extrabold" style="color: #60a5fa;">0</p>
            </div>
            <div class="card relative">
                <h3 class="text-amber-700 text-sm uppercase tracking-wider mb-3">üîÆ Level 3 (Fractions)</h3>
                <p id="level3Count" class="stat-number text-6xl font-extrabold" style="color: #c084fc;">0</p>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 flex gap-4 border-b-2 border-amber-900">
            <button class="tab-button active" onclick="switchTab('create')">
                ‚úçÔ∏è Create Question
            </button>
            <button class="tab-button" onclick="switchTab('manage')">
                üìã Manage Questions
            </button>
        </div>

        <!-- Create Question Tab -->
        <div id="createTab" class="card">
            <h2 class="text-3xl font-bold mb-6" style="color: #d4af37;">‚öîÔ∏è Forge a New Challenge</h2>
            
            <form id="questionForm" class="space-y-6">
                <div>
                    <label class="block text-amber-700 mb-2 font-semibold">Level/Difficulty</label>
                    <select id="levelSelect" class="medieval-select" required>
                        <option value="">Select a level...</option>
                        <option value="level1">Level 1 - Arithmetic (Addition, Subtraction, Multiplication, Division)</option>
                        <option value="level2">Level 2 - Geometry (Area, Perimeter, Volume)</option>
                        <option value="level3">Level 3 - Fractions (Addition, Subtraction, Multiplication)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-amber-700 mb-2 font-semibold">Question</label>
                    <textarea 
                        id="questionInput" 
                        class="medieval-textarea" 
                        rows="3" 
                        placeholder="Enter the math question (e.g., 'What is 25 + 17?')"
                        required
                    ></textarea>
                    <p class="text-sm text-amber-800 mt-1">üí° Tip: Be clear and concise. Use symbols like +, -, √ó, √∑</p>
                </div>

                <div>
                    <label class="block text-amber-700 mb-2 font-semibold">Correct Answer</label>
                    <input 
                        type="number" 
                        id="correctAnswerInput" 
                        class="medieval-input" 
                        placeholder="Enter the correct answer (numbers only)"
                        step="0.01"
                        required
                    />
                </div>

                <div>
                    <label class="block text-amber-700 mb-2 font-semibold">Wrong Answers (3 required)</label>
                    <div class="space-y-3">
                        <input 
                            type="number" 
                            id="wrongAnswer1" 
                            class="medieval-input" 
                            placeholder="Wrong answer #1"
                            step="0.01"
                            required
                        />
                        <input 
                            type="number" 
                            id="wrongAnswer2" 
                            class="medieval-input" 
                            placeholder="Wrong answer #2"
                            step="0.01"
                            required
                        />
                        <input 
                            type="number" 
                            id="wrongAnswer3" 
                            class="medieval-input" 
                            placeholder="Wrong answer #3"
                            step="0.01"
                            required
                        />
                    </div>
                    <p class="text-sm text-amber-800 mt-1">üí° Make them challenging but not too similar to the correct answer</p>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="medieval-button flex items-center gap-2">
                        <span id="submitButtonText">‚öîÔ∏è Create Question</span>
                        <span id="submitLoader" class="loading hidden"></span>
                    </button>
                    <button type="button" onclick="resetForm()" class="medieval-button medieval-button-secondary">
                        üîÑ Reset Form
                    </button>
                </div>
            </form>
        </div>

        <!-- Manage Questions Tab -->
        <div id="manageTab" class="card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold" style="color: #d4af37;">üìã Quest Archives</h2>
                <select id="filterLevel" class="medieval-select" style="width: auto;" onchange="filterQuestions()">
                    <option value="all">All Levels</option>
                    <option value="level1">Level 1 - Arithmetic</option>
                    <option value="level2">Level 2 - Geometry</option>
                    <option value="level3">Level 3 - Fractions</option>
                </select>
            </div>

            <div id="questionsList" class="space-y-4">
                <p class="text-center text-amber-800 py-8">Loading questions...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC_FAR2wX6v8r0TDxqdMhEEl6hjxwSqnrg",
            authDomain: "numeris-c8ae4.firebaseapp.com",
            databaseURL: "https://numeris-c8ae4-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "numeris-c8ae4",
            storageBucket: "numeris-c8ae4.firebasestorage.app",
            messagingSenderId: "238531920666",
            appId: "1:238531920666:web:224c4465112f733ebc62a3",
            measurementId: "G-0VW0P42F6S"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let allQuestions = {};
        let currentFilter = 'all';

        // Listen to connection status
        const connectedRef = ref(db, '.info/connected');
        onValue(connectedRef, (snap) => {
            const statusEl = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                statusEl.textContent = 'üü¢ Connected';
                statusEl.className = 'medieval-button';
            } else {
                statusEl.textContent = 'üî¥ Disconnected';
                statusEl.className = 'medieval-button';
                statusEl.style.background = 'linear-gradient(to bottom, #8b1414, #6d1010)';
            }
        });

        // Listen to questions database
        const questionsRef = ref(db, 'customQuestions');
        onValue(questionsRef, (snapshot) => {
            allQuestions = snapshot.val() || {};
            updateStatistics();
            displayQuestions();
        });

        // Form submission
        document.getElementById('questionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitButtonText');
            const loader = document.getElementById('submitLoader');
            submitBtn.textContent = 'Creating...';
            loader.classList.remove('hidden');
            
            const level = document.getElementById('levelSelect').value;
            const question = document.getElementById('questionInput').value;
            const correctAnswer = parseFloat(document.getElementById('correctAnswerInput').value);
            const wrongAnswers = [
                parseFloat(document.getElementById('wrongAnswer1').value),
                parseFloat(document.getElementById('wrongAnswer2').value),
                parseFloat(document.getElementById('wrongAnswer3').value)
            ];

            // Validate that wrong answers are different from correct answer
            const hasDuplicate = wrongAnswers.some(ans => ans === correctAnswer);
            if (hasDuplicate) {
                showToast('‚ö†Ô∏è Wrong answers must be different from the correct answer!', 'error');
                submitBtn.textContent = '‚öîÔ∏è Create Question';
                loader.classList.add('hidden');
                return;
            }

            const questionData = {
                level: level,
                question: question,
                correctAnswer: correctAnswer,
                wrongAnswers: wrongAnswers,
                createdAt: Date.now()
            };

            try {
                const newQuestionRef = push(ref(db, `customQuestions/${level}`));
                await set(newQuestionRef, questionData);
                
                showToast('‚úÖ Question created successfully!', 'success');
                resetForm();
            } catch (error) {
                console.error('Error creating question:', error);
                showToast('‚ùå Failed to create question. Please try again.', 'error');
            } finally {
                submitBtn.textContent = '‚öîÔ∏è Create Question';
                loader.classList.add('hidden');
            }
        });

        // Update statistics
        function updateStatistics() {
            let total = 0;
            let level1 = 0;
            let level2 = 0;
            let level3 = 0;

            Object.keys(allQuestions).forEach(level => {
                const count = Object.keys(allQuestions[level] || {}).length;
                total += count;
                
                if (level === 'level1') level1 = count;
                if (level === 'level2') level2 = count;
                if (level === 'level3') level3 = count;
            });

            document.getElementById('totalQuestions').textContent = total;
            document.getElementById('level1Count').textContent = level1;
            document.getElementById('level2Count').textContent = level2;
            document.getElementById('level3Count').textContent = level3;
        }

        // Display questions
        function displayQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = '';

            let hasQuestions = false;

            Object.keys(allQuestions).forEach(level => {
                if (currentFilter !== 'all' && currentFilter !== level) return;

                const levelQuestions = allQuestions[level] || {};
                Object.keys(levelQuestions).forEach(questionId => {
                    hasQuestions = true;
                    const q = levelQuestions[questionId];
                    
                    const badgeClass = level === 'level1' ? 'badge-level1' : 
                                      level === 'level2' ? 'badge-level2' : 'badge-level3';
                    const levelName = level === 'level1' ? 'Arithmetic' : 
                                     level === 'level2' ? 'Geometry' : 'Fractions';

                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <span class="badge ${badgeClass}">${levelName}</span>
                                <h3 class="text-xl font-semibold mt-2" style="color: #f0c674;">${q.question}</h3>
                            </div>
                            <button 
                                onclick="deleteQuestion('${level}', '${questionId}')"
                                class="medieval-button medieval-button-danger text-sm px-3 py-1"
                            >
                                üóëÔ∏è Delete
                            </button>
                        </div>
                        <div class="mt-3 space-y-1" style="color: #c4945f;">
                            <p><strong>‚úÖ Correct:</strong> ${q.correctAnswer}</p>
                            <p><strong>‚ùå Wrong:</strong> ${q.wrongAnswers.join(', ')}</p>
                        </div>
                    `;
                    
                    container.appendChild(questionDiv);
                });
            });

            if (!hasQuestions) {
                container.innerHTML = '<p class="text-center text-amber-800 py-8">No questions found. Create your first challenge!</p>';
            }
        }

        // Delete question
        window.deleteQuestion = async (level, questionId) => {
            if (!confirm('Are you sure you want to delete this question?')) return;

            try {
                await remove(ref(db, `customQuestions/${level}/${questionId}`));
                showToast('‚úÖ Question deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting question:', error);
                showToast('‚ùå Failed to delete question.', 'error');
            }
        };

        // Filter questions
        window.filterQuestions = () => {
            currentFilter = document.getElementById('filterLevel').value;
            displayQuestions();
        };

        // Tab switching
        window.switchTab = (tab) => {
            const createTab = document.getElementById('createTab');
            const manageTab = document.getElementById('manageTab');
            const tabs = document.querySelectorAll('.tab-button');

            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'create') {
                createTab.classList.remove('hidden');
                manageTab.classList.add('hidden');
                tabs[0].classList.add('active');
            } else {
                createTab.classList.add('hidden');
                manageTab.classList.remove('hidden');
                tabs[1].classList.add('active');
            }
        };

        // Reset form
        window.resetForm = () => {
            document.getElementById('questionForm').reset();
        };

        // Toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.background = 'linear-gradient(to bottom, #8b1414, #6d1010)';
                toast.style.borderColor = '#d43737';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>